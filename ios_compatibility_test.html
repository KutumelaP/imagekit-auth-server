<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>iOS Compatibility Test - Mzansi Marketplace</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success { background: #d4edda; color: #155724; }
        .warning { background: #fff3cd; color: #856404; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
        }
        .test-button:hover { background: #0056b3; }
        .log {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>üì± iOS Compatibility Test</h1>
    <p>Testing your Mzansi Marketplace app for iOS compatibility...</p>

    <div class="test-section">
        <h2>üîç Browser Detection</h2>
        <div id="browser-info"></div>
    </div>

    <div class="test-section">
        <h2>üìê Viewport & Dimensions</h2>
        <div id="viewport-info"></div>
        <button class="test-button" onclick="testViewport()">Test Viewport</button>
    </div>

    <div class="test-section">
        <h2>‚å®Ô∏è Keyboard & Input</h2>
        <div id="keyboard-info"></div>
        <input type="text" placeholder="Tap to test keyboard" style="width: 100%; padding: 10px; margin: 10px 0;">
        <button class="test-button" onclick="testKeyboard()">Test Keyboard Events</button>
    </div>

    <div class="test-section">
        <h2>üîÑ Touch & Gestures</h2>
        <div id="touch-info"></div>
        <div id="touch-area" style="width: 100%; height: 100px; background: #e9ecef; border: 2px dashed #6c757d; display: flex; align-items: center; justify-content: center; margin: 10px 0;">
            Touch this area to test gestures
        </div>
    </div>

    <div class="test-section">
        <h2>üß† Memory & Performance</h2>
        <div id="memory-info"></div>
        <button class="test-button" onclick="testMemory()">Test Memory</button>
    </div>

    <div class="test-section">
        <h2>üîó App Link Test</h2>
        <div id="app-link-info"></div>
        <button class="test-button" onclick="testAppLink()">Test App Link</button>
    </div>

    <div class="test-section">
        <h2>üìù Test Log</h2>
        <div id="test-log" class="log"></div>
        <button class="test-button" onclick="clearLog()">Clear Log</button>
    </div>

    <script>
        let logElement = document.getElementById('test-log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `status ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logElement.innerHTML = '';
        }

        // Browser Detection
        function detectBrowser() {
            const ua = navigator.userAgent;
            const isIOS = /iPad|iPhone|iPod/.test(ua);
            const isSafari = /Safari/.test(ua) && !/Chrome/.test(ua);
            const isChrome = /Chrome/.test(ua);
            const isFirefox = /Firefox/.test(ua);
            
            let browserInfo = `
                <div class="status info">
                    <strong>User Agent:</strong> ${ua}
                </div>
                <div class="status ${isIOS ? 'success' : 'warning'}">
                    <strong>iOS Device:</strong> ${isIOS ? '‚úÖ Yes' : '‚ùå No'}
                </div>
                <div class="status ${isSafari ? 'success' : 'info'}">
                    <strong>Safari:</strong> ${isSafari ? '‚úÖ Yes' : '‚ùå No'}
                </div>
                <div class="status info">
                    <strong>Chrome:</strong> ${isChrome ? '‚úÖ Yes' : '‚ùå No'}
                </div>
                <div class="status info">
                    <strong>Firefox:</strong> ${isFirefox ? '‚úÖ Yes' : '‚ùå No'}
                </div>
            `;
            
            document.getElementById('browser-info').innerHTML = browserInfo;
            
            if (isIOS) {
                log('‚úÖ iOS device detected', 'success');
                if (isSafari) {
                    log('‚úÖ Safari browser detected', 'success');
                } else {
                    log('‚ö†Ô∏è iOS device but not Safari - may have different behavior', 'warning');
                }
            } else {
                log('‚ÑπÔ∏è Non-iOS device - testing for compatibility', 'info');
            }
        }

        // Viewport Testing
        function testViewport() {
            const vw = window.innerWidth;
            const vh = window.innerHeight;
            const screenW = screen.width;
            const screenH = screen.height;
            const pixelRatio = window.devicePixelRatio;
            
            let viewportInfo = `
                <div class="status info">
                    <strong>Viewport Width:</strong> ${vw}px
                </div>
                <div class="status info">
                    <strong>Viewport Height:</strong> ${vh}px
                </div>
                <div class="status info">
                    <strong>Screen Width:</strong> ${screenW}px
                </div>
                <div class="status info">
                    <strong>Screen Height:</strong> ${screenH}px
                </div>
                <div class="status info">
                    <strong>Device Pixel Ratio:</strong> ${pixelRatio}
                </div>
            `;
            
            document.getElementById('viewport-info').innerHTML = viewportInfo;
            
            log(`Viewport: ${vw}x${vh}, Screen: ${screenW}x${screenH}, DPR: ${pixelRatio}`, 'info');
            
            // Test dynamic viewport units
            if (CSS.supports('height', '100dvh')) {
                log('‚úÖ Dynamic viewport units supported (100dvh)', 'success');
            } else {
                log('‚ùå Dynamic viewport units not supported', 'warning');
            }
        }

        // Keyboard Testing
        function testKeyboard() {
            let keyboardInfo = `
                <div class="status info">
                    <strong>Virtual Keyboard:</strong> Testing...
                </div>
            `;
            
            document.getElementById('keyboard-info').innerHTML = keyboardInfo;
            
            // Test visual viewport API
            if (window.visualViewport) {
                log('‚úÖ Visual Viewport API supported', 'success');
                
                window.visualViewport.addEventListener('resize', () => {
                    log(`Keyboard event: viewport resized to ${window.visualViewport.height}px`, 'info');
                });
            } else {
                log('‚ùå Visual Viewport API not supported', 'warning');
            }
            
            // Test resize events
            let resizeCount = 0;
            const resizeHandler = () => {
                resizeCount++;
                log(`Resize event #${resizeCount}: ${window.innerWidth}x${window.innerHeight}`, 'info');
                
                if (resizeCount >= 3) {
                    window.removeEventListener('resize', resizeHandler);
                    log('‚úÖ Resize events working properly', 'success');
                }
            };
            
            window.addEventListener('resize', resizeHandler);
            
            // Simulate keyboard show/hide
            setTimeout(() => {
                log('Simulating keyboard events...', 'info');
                window.dispatchEvent(new Event('resize'));
            }, 1000);
        }

        // Touch Testing
        function testTouch() {
            const touchArea = document.getElementById('touch-area');
            let touchCount = 0;
            
            touchArea.addEventListener('touchstart', (e) => {
                e.preventDefault();
                touchCount++;
                log(`Touch start #${touchCount}: ${e.touches.length} finger(s)`, 'info');
            });
            
            touchArea.addEventListener('touchmove', (e) => {
                e.preventDefault();
                log(`Touch move: ${e.touches.length} finger(s)`, 'info');
            });
            
            touchArea.addEventListener('touchend', (e) => {
                e.preventDefault();
                log(`Touch end: ${e.touches.length} finger(s)`, 'info');
            });
            
            let touchInfo = `
                <div class="status info">
                    <strong>Touch Events:</strong> ${touchCount} touches detected
                </div>
                <div class="status info">
                    <strong>Touch Support:</strong> ${('ontouchstart' in window) ? '‚úÖ Yes' : '‚ùå No'}
                </div>
            `;
            
            document.getElementById('touch-info').innerHTML = touchInfo;
        }

        // Memory Testing
        function testMemory() {
            let memoryInfo = `
                <div class="status info">
                    <strong>Memory:</strong> Testing...
                </div>
            `;
            
            document.getElementById('memory-info').innerHTML = memoryInfo;
            
            // Test memory pressure
            if ('memory' in performance) {
                const memory = performance.memory;
                log(`Memory: Used ${Math.round(memory.usedJSHeapSize / 1024 / 1024)}MB / ${Math.round(memory.totalJSHeapSize / 1024 / 1024)}MB`, 'info');
                
                memoryInfo = `
                    <div class="status info">
                        <strong>Used Heap:</strong> ${Math.round(memory.usedJSHeapSize / 1024 / 1024)}MB
                    </div>
                    <div class="status info">
                        <strong>Total Heap:</strong> ${Math.round(memory.totalJSHeapSize / 1024 / 1024)}MB
                    </div>
                    <div class="status info">
                        <strong>Heap Limit:</strong> ${Math.round(memory.jsHeapSizeLimit / 1024 / 1024)}MB
                    </div>
                `;
            } else {
                log('‚ùå Memory API not available', 'warning');
                memoryInfo = `
                    <div class="status warning">
                        <strong>Memory API:</strong> Not available
                    </div>
                `;
            }
            
            document.getElementById('memory-info').innerHTML = memoryInfo;
        }

        // App Link Testing
        function testAppLink() {
            let appLinkInfo = `
                <div class="status info">
                    <strong>App Link:</strong> Testing...
                </div>
            `;
            
            document.getElementById('app-link-info').innerHTML = appLinkInfo;
            
            // Test if we can open the marketplace app
            try {
                const appUrl = 'https://marketplace-8d6bd.web.app';
                log(`Testing app link: ${appUrl}`, 'info');
                
                // Test if we can navigate
                const link = document.createElement('a');
                link.href = appUrl;
                link.target = '_blank';
                link.click();
                
                log('‚úÖ App link test completed', 'success');
                
                appLinkInfo = `
                    <div class="status success">
                        <strong>App Link:</strong> ‚úÖ Working
                    </div>
                    <div class="status info">
                        <strong>URL:</strong> <a href="${appUrl}" target="_blank">${appUrl}</a>
                    </div>
                `;
            } catch (e) {
                log(`‚ùå App link test failed: ${e.message}`, 'error');
                appLinkInfo = `
                    <div class="status error">
                        <strong>App Link:</strong> ‚ùå Failed
                    </div>
                `;
            }
            
            document.getElementById('app-link-info').innerHTML = appLinkInfo;
        }

        // Initialize tests
        window.addEventListener('load', () => {
            log('üöÄ iOS Compatibility Test Started', 'success');
            detectBrowser();
            testViewport();
            testTouch();
            
            // Auto-test keyboard after a delay
            setTimeout(() => {
                testKeyboard();
            }, 2000);
        });

        // Handle orientation changes
        window.addEventListener('orientationchange', () => {
            log('üì± Orientation changed', 'info');
            setTimeout(testViewport, 100);
        });

        // Handle visibility changes
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                log('üëÅÔ∏è Page hidden (app backgrounded)', 'info');
            } else {
                log('üëÅÔ∏è Page visible (app foregrounded)', 'info');
            }
        });
    </script>
</body>
</html>
